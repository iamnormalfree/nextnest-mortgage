<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Lead Form Testing - NextNest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .test-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .output-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
        }
        
        .output-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .output-card pre {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .insight-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 3px solid #48bb78;
        }
        
        .insight-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .insight-message {
            color: #718096;
            font-size: 14px;
        }
        
        .urgency-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .urgency-immediate {
            background: #feb2b2;
            color: #742a2a;
        }
        
        .urgency-soon {
            background: #fbd38d;
            color: #744210;
        }
        
        .urgency-planning {
            background: #9ae6b4;
            color: #22543d;
        }
        
        .urgency-exploring {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .json-output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .scenario-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .scenario-btn {
            padding: 10px 15px;
            background: #f7f7f7;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 14px;
        }
        
        .scenario-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Comprehensive Lead Form Testing Interface</h1>
        
        <div class="test-grid">
            <!-- Input Panel -->
            <div class="panel">
                <h2>Complete Lead Data Testing</h2>
                
                <div class="scenario-buttons">
                    <button class="scenario-btn" onclick="loadScenario('newPurchaseResale')">New Purchase - Resale</button>
                    <button class="scenario-btn" onclick="loadScenario('newPurchaseBTO')">New Purchase - BTO</button>
                    <button class="scenario-btn" onclick="loadScenario('refinanceUrgent')">Refinance - Urgent</button>
                    <button class="scenario-btn" onclick="loadScenario('commercial')">Commercial Property</button>
                </div>
                
                <!-- Gate 0 & 1 Fields -->
                <div class="form-section">
                    <h3>Gate 0-1: Basic Information</h3>
                    <div class="form-group">
                        <label>Loan Type</label>
                        <select id="loanType" onchange="updateFormFields()">
                            <option value="new_purchase">New Purchase</option>
                            <option value="refinance">Refinance</option>
                            <option value="commercial">Commercial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="name" value="John Tan Wei Ming" placeholder="Full name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" value="john.tan@example.com" placeholder="Email address">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="phone" value="91234567" placeholder="Singapore phone">
                    </div>
                </div>
                
                <!-- Gate 2: Loan-Specific Fields -->
                <div class="form-section">
                    <h3>Gate 2: Loan-Specific Information</h3>
                    
                    <!-- New Purchase Fields -->
                    <div id="newPurchaseFields" style="display: block;">
                        <div class="form-group">
                            <label>Property Category</label>
                            <select id="propertyCategory">
                                <option value="resale">Resale Property</option>
                                <option value="new_launch">New Launch</option>
                                <option value="bto">BTO Application</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Property Type</label>
                            <select id="propertyType">
                                <option value="HDB">HDB</option>
                                <option value="EC">Executive Condominium</option>
                                <option value="Private">Private Property</option>
                                <option value="Landed">Landed Property</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price Range</label>
                            <input type="number" id="priceRange" value="800000" placeholder="Property price">
                        </div>
                        <div class="form-group">
                            <label>Purchase Timeline</label>
                            <select id="purchaseTimeline">
                                <option value="this_month">This Month</option>
                                <option value="next_3_months">Next 3 Months</option>
                                <option value="3_6_months">3-6 Months</option>
                                <option value="exploring">Just Exploring</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>IPA Status</label>
                            <select id="ipaStatus">
                                <option value="have_ipa">Have IPA</option>
                                <option value="applied">Applied</option>
                                <option value="starting">Just Starting</option>
                                <option value="what_is_ipa">What is IPA?</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>First Time Buyer</label>
                            <select id="firstTimeBuyer">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Refinance Fields -->
                    <div id="refinanceFields" style="display: none;">
                        <div class="form-group">
                            <label>Current Interest Rate (%)</label>
                            <input type="number" id="currentRate" step="0.1" value="3.5" placeholder="Current rate">
                        </div>
                        <div class="form-group">
                            <label>Lock-in Status</label>
                            <select id="lockInStatus">
                                <option value="ending_soon">Ending Soon</option>
                                <option value="no_lock">No Lock-in</option>
                                <option value="locked">Currently Locked</option>
                                <option value="not_sure">Not Sure</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Current Bank</label>
                            <input type="text" id="currentBank" value="DBS" placeholder="Current bank">
                        </div>
                        <div class="form-group">
                            <label>Property Value</label>
                            <input type="number" id="propertyValue" value="1200000" placeholder="Current property value">
                        </div>
                        <div class="form-group">
                            <label>Outstanding Loan</label>
                            <input type="number" id="outstandingLoan" value="400000" placeholder="Outstanding loan amount">
                        </div>
                    </div>
                    
                    <!-- Commercial Fields -->
                    <div id="commercialFields" style="display: none;">
                        <div class="form-group">
                            <label>Business Type</label>
                            <select id="businessType">
                                <option value="retail">Retail</option>
                                <option value="office">Office</option>
                                <option value="industrial">Industrial</option>
                                <option value="warehouse">Warehouse</option>
                                <option value="mixed">Mixed Use</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Commercial Property Value</label>
                            <input type="number" id="commercialValue" value="2500000" placeholder="Property value">
                        </div>
                        <div class="form-group">
                            <label>Business Revenue (Annual)</label>
                            <input type="number" id="businessRevenue" value="1200000" placeholder="Annual revenue">
                        </div>
                    </div>
                </div>
                
                <!-- Gate 3: Optimization Parameters -->
                <div class="form-section">
                    <h3>Gate 3: Financial Profile & Preferences</h3>
                    <div class="form-group">
                        <label>Monthly Income</label>
                        <input type="number" id="monthlyIncome" value="15000" placeholder="Monthly income">
                    </div>
                    <div class="form-group">
                        <label>Existing Commitments (Optional)</label>
                        <input type="number" id="existingCommitments" value="3000" placeholder="Monthly commitments">
                    </div>
                    <div class="form-group">
                        <label>Package Preference</label>
                        <select id="packagePreference">
                            <option value="lowest_rate">Lowest Rate</option>
                            <option value="flexibility">Maximum Flexibility</option>
                            <option value="stability">Rate Stability</option>
                            <option value="features">Additional Features</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Risk Tolerance</label>
                        <select id="riskTolerance">
                            <option value="conservative">Conservative</option>
                            <option value="moderate">Moderate</option>
                            <option value="aggressive">Aggressive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Planning Horizon</label>
                        <select id="planningHorizon">
                            <option value="short_term">Short Term (1-2 years)</option>
                            <option value="medium_term">Medium Term (3-5 years)</option>
                            <option value="long_term">Long Term (5+ years)</option>
                        </select>
                    </div>
                </div>
                
                <button class="test-btn" onclick="runCompleteAnalysis()">
                    🚀 Run Complete Algorithmic Analysis
                </button>
            </div>
            
            <!-- Output Panel -->
            <div class="panel">
                <h2>Complete Analysis Results</h2>
                
                <div id="outputArea">
                    <div class="loading">Ready to analyze complete lead data...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Comprehensive test scenarios
        const scenarios = {
            newPurchaseResale: {
                loanType: 'new_purchase',
                name: 'Sarah Lim',
                email: 'sarah.lim@gmail.com',
                phone: '98765432',
                propertyCategory: 'resale',
                propertyType: 'Private',
                priceRange: 1200000,
                purchaseTimeline: 'next_3_months',
                ipaStatus: 'applied',
                firstTimeBuyer: 'false',
                monthlyIncome: 18000,
                existingCommitments: 4000,
                packagePreference: 'lowest_rate',
                riskTolerance: 'moderate',
                planningHorizon: 'medium_term'
            },
            newPurchaseBTO: {
                loanType: 'new_purchase',
                name: 'Ahmad Rahman',
                email: 'ahmad.rahman@example.com',
                phone: '91234567',
                propertyCategory: 'bto',
                propertyType: 'HDB',
                priceRange: 450000,
                purchaseTimeline: '3_6_months',
                ipaStatus: 'starting',
                firstTimeBuyer: 'true',
                monthlyIncome: 8000,
                existingCommitments: 1200,
                packagePreference: 'stability',
                riskTolerance: 'conservative',
                planningHorizon: 'long_term'
            },
            refinanceUrgent: {
                loanType: 'refinance',
                name: 'Lisa Wong',
                email: 'lisa.wong@company.com',
                phone: '87654321',
                currentRate: 2.8,
                lockInStatus: 'ending_soon',
                currentBank: 'OCBC',
                propertyValue: 1800000,
                outstandingLoan: 800000,
                monthlyIncome: 22000,
                existingCommitments: 3500,
                packagePreference: 'flexibility',
                riskTolerance: 'aggressive',
                planningHorizon: 'short_term'
            },
            commercial: {
                loanType: 'commercial',
                name: 'Business Holdings Pte Ltd',
                email: 'finance@business.com.sg',
                phone: '65551234',
                businessType: 'retail',
                commercialValue: 3200000,
                businessRevenue: 2400000,
                monthlyIncome: 45000,
                existingCommitments: 12000,
                packagePreference: 'features',
                riskTolerance: 'moderate',
                planningHorizon: 'medium_term'
            }
        };
        
        function loadScenario(scenarioName) {
            const scenario = scenarios[scenarioName];
            
            // Load all form values
            Object.keys(scenario).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = scenario[key];
                }
            });
            
            // Update form fields based on loan type
            updateFormFields();
        }
        
        function updateFormFields() {
            const loanType = document.getElementById('loanType').value;
            
            // Hide all loan-specific sections
            document.getElementById('newPurchaseFields').style.display = 'none';
            document.getElementById('refinanceFields').style.display = 'none';
            document.getElementById('commercialFields').style.display = 'none';
            
            // Show relevant section
            switch(loanType) {
                case 'new_purchase':
                    document.getElementById('newPurchaseFields').style.display = 'block';
                    break;
                case 'refinance':
                    document.getElementById('refinanceFields').style.display = 'block';
                    break;
                case 'commercial':
                    document.getElementById('commercialFields').style.display = 'block';
                    break;
            }
        }
        
        function gatherFormData() {
            const data = {
                // Gate 0-1 data
                loanType: document.getElementById('loanType').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                
                // Gate 3 data
                monthlyIncome: parseInt(document.getElementById('monthlyIncome').value),
                existingCommitments: parseInt(document.getElementById('existingCommitments').value) || 0,
                packagePreference: document.getElementById('packagePreference').value,
                riskTolerance: document.getElementById('riskTolerance').value,
                planningHorizon: document.getElementById('planningHorizon').value,
            };
            
            // Add loan-specific data
            switch(data.loanType) {
                case 'new_purchase':
                    data.propertyCategory = document.getElementById('propertyCategory').value;
                    data.propertyType = document.getElementById('propertyType').value;
                    data.priceRange = parseInt(document.getElementById('priceRange').value);
                    data.purchaseTimeline = document.getElementById('purchaseTimeline').value;
                    data.ipaStatus = document.getElementById('ipaStatus').value;
                    data.firstTimeBuyer = document.getElementById('firstTimeBuyer').value === 'true';
                    break;
                case 'refinance':
                    data.currentRate = parseFloat(document.getElementById('currentRate').value);
                    data.lockInStatus = document.getElementById('lockInStatus').value;
                    data.currentBank = document.getElementById('currentBank').value;
                    data.propertyValue = parseInt(document.getElementById('propertyValue').value);
                    data.outstandingLoan = parseInt(document.getElementById('outstandingLoan').value);
                    break;
                case 'commercial':
                    data.businessType = document.getElementById('businessType').value;
                    data.propertyValue = parseInt(document.getElementById('commercialValue').value);
                    data.businessRevenue = parseInt(document.getElementById('businessRevenue').value);
                    break;
            }
            
            return data;
        }
        
        async function runCompleteAnalysis() {
            const formData = gatherFormData();
            
            document.getElementById('outputArea').innerHTML = '<div class="loading">Processing complete lead analysis...</div>';
            
            // Simulate API call to analyze complete form data
            setTimeout(() => {
                displayCompleteResults(formData);
            }, 2000);
        }
        
        function calculateUrgencyProfile(formData) {
            let urgencyLevel = 'exploring';
            let urgencyScore = 5;
            let urgencySource = 'default';
            let urgencyReason = 'General inquiry';
            
            switch(formData.loanType) {
                case 'new_purchase':
                    switch(formData.purchaseTimeline) {
                        case 'this_month':
                            urgencyLevel = 'immediate';
                            urgencyScore = 20;
                            urgencySource = 'purchaseTimeline';
                            urgencyReason = 'Property purchase planned this month - urgent pre-approval needed';
                            break;
                        case 'next_3_months':
                            urgencyLevel = 'soon';
                            urgencyScore = 15;
                            urgencySource = 'purchaseTimeline';
                            urgencyReason = 'Purchasing within 3 months - active property search';
                            break;
                        case '3_6_months':
                            urgencyLevel = 'planning';
                            urgencyScore = 10;
                            urgencySource = 'purchaseTimeline';
                            urgencyReason = 'Planning purchase in 3-6 months - preparation phase';
                            break;
                        case 'exploring':
                            urgencyLevel = 'exploring';
                            urgencyScore = 5;
                            urgencySource = 'purchaseTimeline';
                            urgencyReason = 'Exploring home ownership options - research phase';
                            break;
                    }
                    break;
                case 'refinance':
                    switch(formData.lockInStatus) {
                        case 'ending_soon':
                            urgencyLevel = 'immediate';
                            urgencyScore = 20;
                            urgencySource = 'lockInStatus';
                            urgencyReason = 'Lock-in period ending soon - immediate action window';
                            break;
                        case 'no_lock':
                            urgencyLevel = 'soon';
                            urgencyScore = 15;
                            urgencySource = 'lockInStatus';
                            urgencyReason = 'No lock-in penalty - can refinance anytime for savings';
                            break;
                        case 'not_sure':
                            urgencyLevel = 'soon';
                            urgencyScore = 12;
                            urgencySource = 'lockInStatus';
                            urgencyReason = 'Lock-in status needs verification - potential opportunity';
                            break;
                        case 'locked':
                            urgencyLevel = 'planning';
                            urgencyScore = 8;
                            urgencySource = 'lockInStatus';
                            urgencyReason = 'Currently in lock-in period - planning for future refinance';
                            break;
                    }
                    break;
                case 'commercial':
                    urgencyLevel = 'immediate';
                    urgencyScore = 19;
                    urgencySource = 'commercial_loan_type';
                    urgencyReason = 'Commercial property financing - specialist broker required';
                    break;
            }
            
            return { urgencyLevel, urgencyScore, urgencySource, urgencyReason };
        }
        
        function calculateAffordability(formData) {
            const income = formData.monthlyIncome;
            const commitments = formData.existingCommitments || 0;
            
            // Singapore MAS compliance calculations
            const tdsrLimit = 0.55; // 55%
            const msrLimit = formData.propertyType === 'HDB' || formData.propertyType === 'EC' ? 0.30 : 0.30; // 30%
            const stressTestRate = 0.04; // 4% stress test
            
            const maxTDSR = (income * tdsrLimit) - commitments;
            const maxMSR = income * msrLimit;
            
            return {
                monthlyIncome: income,
                existingCommitments: commitments,
                maxTDSR: Math.max(0, maxTDSR),
                maxMSR: maxMSR,
                effectiveLimit: Math.min(maxTDSR, maxMSR),
                tdsrUtilization: commitments / (income * tdsrLimit),
                remainingCapacity: Math.max(0, Math.min(maxTDSR, maxMSR))
            };
        }
        
        function generateInsights(formData) {
            const urgency = calculateUrgencyProfile(formData);
            const affordability = calculateAffordability(formData);
            const insights = [];
            
            // Primary insight based on loan type and urgency
            insights.push({
                type: 'primary',
                title: `${urgency.urgencyLevel.charAt(0).toUpperCase() + urgency.urgencyLevel.slice(1)} Action Required`,
                message: urgency.urgencyReason,
                urgency: urgency.urgencyLevel,
                actionItems: generateActionItems(formData, urgency)
            });
            
            // Financial capacity insight
            if (affordability.remainingCapacity > 0) {
                insights.push({
                    type: 'financial',
                    title: 'Strong Financial Profile',
                    message: `You can afford up to $${Math.round(affordability.remainingCapacity).toLocaleString()} in monthly loan payments based on MAS guidelines.`,
                    urgency: 'planning',
                    details: affordability
                });
            }
            
            // Property-specific insights
            if (formData.loanType === 'new_purchase') {
                insights.push({
                    type: 'property',
                    title: `${formData.propertyType} Purchase Strategy`,
                    message: generatePropertyInsight(formData),
                    urgency: 'planning'
                });
            }
            
            // Risk-based recommendations
            insights.push({
                type: 'risk',
                title: `${formData.riskTolerance.charAt(0).toUpperCase() + formData.riskTolerance.slice(1)} Strategy Recommended`,
                message: generateRiskInsight(formData),
                urgency: 'planning'
            });
            
            return insights;
        }
        
        function generateActionItems(formData, urgency) {
            const actions = [];
            
            switch(formData.loanType) {
                case 'new_purchase':
                    if (urgency.urgencyLevel === 'immediate') {
                        actions.push('Apply for IPA immediately', 'Prepare income documents', 'Schedule property viewing', 'Lock in pre-approval rates');
                    } else {
                        actions.push('Start IPA application process', 'Research property options', 'Prepare financial documents', 'Compare mortgage packages');
                    }
                    break;
                case 'refinance':
                    if (urgency.urgencyLevel === 'immediate') {
                        actions.push('Get current property valuation', 'Apply to multiple banks', 'Calculate potential savings', 'Schedule broker consultation');
                    } else {
                        actions.push('Monitor interest rate trends', 'Prepare refinancing documents', 'Research package options', 'Plan timing strategy');
                    }
                    break;
                case 'commercial':
                    actions.push('Schedule commercial specialist consultation', 'Prepare business financials', 'Property valuation assessment', 'Structure optimization review');
                    break;
            }
            
            return actions;
        }
        
        function generatePropertyInsight(formData) {
            switch(formData.propertyType) {
                case 'HDB':
                    return `HDB properties offer maximum financing flexibility with 90% LTV and CPF usage. ${formData.firstTimeBuyer ? 'As a first-time buyer, you may be eligible for housing grants up to $80,000.' : 'Consider upgrading opportunities with current market conditions.'}`;
                case 'Private':
                    return `Private properties typically allow 75% LTV for first property. Current market shows ${formData.propertyCategory === 'resale' ? 'resale' : 'new launch'} opportunities with different payment structures.`;
                case 'EC':
                    return 'Executive Condominiums offer a good balance between HDB and private property benefits, with 90% LTV available.';
                case 'Landed':
                    return 'Landed properties represent premium segment with 75% LTV. Consider long-term appreciation potential and maintenance costs.';
                default:
                    return 'Property selection impacts financing options and long-term investment strategy.';
            }
        }
        
        function generateRiskInsight(formData) {
            switch(formData.riskTolerance) {
                case 'conservative':
                    return `Fixed rate packages recommended for certainty. Focus on established lenders and stable repayment structures. ${formData.planningHorizon === 'long_term' ? 'Long-term planning aligns well with conservative approach.' : ''}`;
                case 'moderate':
                    return `Hybrid packages may offer good balance between stability and flexibility. Consider market timing for optimal package selection. ${formData.packagePreference === 'flexibility' ? 'Your preference for flexibility supports moderate risk strategy.' : ''}`;
                case 'aggressive':
                    return `Floating rate packages may capitalize on favorable rate environments. Consider advanced products and alternative lenders. Monitor market conditions closely.`;
                default:
                    return 'Risk assessment helps determine optimal mortgage structure and package selection.';
            }
        }
        
        function displayCompleteResults(formData) {
            const urgency = calculateUrgencyProfile(formData);
            const affordability = calculateAffordability(formData);
            const insights = generateInsights(formData);
            
            const output = `
                <div class="output-card">
                    <h3>📋 Complete Lead Analysis Summary</h3>
                    <pre>Name: ${formData.name}
Email: ${formData.email}
Phone: ${formData.phone}
Loan Type: ${formData.loanType.replace('_', ' ').toUpperCase()}
${formData.loanType === 'new_purchase' ? `Property: ${formData.propertyType} (${formData.propertyCategory})
Price Range: $${formData.priceRange?.toLocaleString()}
Timeline: ${formData.purchaseTimeline}` : ''}
${formData.loanType === 'refinance' ? `Current Rate: ${formData.currentRate}%
Lock-in Status: ${formData.lockInStatus}
Current Bank: ${formData.currentBank}
Property Value: $${formData.propertyValue?.toLocaleString()}` : ''}
${formData.loanType === 'commercial' ? `Business Type: ${formData.businessType}
Property Value: $${formData.propertyValue?.toLocaleString()}
Annual Revenue: $${formData.businessRevenue?.toLocaleString()}` : ''}</pre>
                </div>
                
                <div class="output-card">
                    <h3>🎯 Urgency Profile</h3>
                    <div class="insight-item">
                        <div class="insight-title">
                            Urgency Level: ${urgency.urgencyLevel.toUpperCase()}
                            <span class="urgency-badge urgency-${urgency.urgencyLevel}">Score: ${urgency.urgencyScore}/20</span>
                        </div>
                        <div class="insight-message">
                            Source: ${urgency.urgencySource}<br>
                            ${urgency.urgencyReason}
                        </div>
                    </div>
                </div>
                
                <div class="output-card">
                    <h3>💰 Financial Assessment (MAS Compliant)</h3>
                    <pre>Monthly Income: $${affordability.monthlyIncome?.toLocaleString()}
Existing Commitments: $${affordability.existingCommitments?.toLocaleString()}
Max TDSR (55%): $${Math.round(affordability.maxTDSR)?.toLocaleString()}
Max MSR (30%): $${Math.round(affordability.maxMSR)?.toLocaleString()}
Effective Limit: $${Math.round(affordability.effectiveLimit)?.toLocaleString()}
Remaining Capacity: $${Math.round(affordability.remainingCapacity)?.toLocaleString()}
TDSR Utilization: ${(affordability.tdsrUtilization * 100).toFixed(1)}%</pre>
                </div>
                
                <div class="output-card">
                    <h3>🧠 Algorithmic Insights</h3>
                    ${insights.map(insight => `
                        <div class="insight-item">
                            <div class="insight-title">
                                ${insight.title}
                                <span class="urgency-badge urgency-${insight.urgency}">${insight.type.toUpperCase()}</span>
                            </div>
                            <div class="insight-message">${insight.message}</div>
                            ${insight.actionItems ? `
                                <div style="margin-top: 10px;">
                                    <strong>Action Items:</strong><br>
                                    ${insight.actionItems.map((item, i) => `${i+1}. ${item}`).join('<br>')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
                
                <div class="output-card">
                    <h3>📊 Lead Scoring</h3>
                    <pre>Urgency Component: ${urgency.urgencyScore}/20
Financial Strength: ${Math.min(20, Math.round(affordability.monthlyIncome / 1000))}/20
Profile Completeness: ${Object.keys(formData).filter(key => formData[key] !== '' && formData[key] !== null).length}/15 fields
Total Lead Score: ${urgency.urgencyScore + Math.min(20, Math.round(affordability.monthlyIncome / 1000)) + Object.keys(formData).filter(key => formData[key] !== '' && formData[key] !== null).length * 2}/60</pre>
                </div>
                
                <div class="output-card">
                    <h3>🔧 Raw Form Data (JSON)</h3>
                    <div class="json-output">${JSON.stringify(formData, null, 2)}</div>
                </div>
                
                ${formData.loanType === 'commercial' ? `
                <div class="output-card">
                    <h3>🏢 Commercial Routing Notice</h3>
                    <div class="insight-item">
                        <div class="insight-title">Direct Broker Consultation Required</div>
                        <div class="insight-message">
                            Commercial property financing requires specialist expertise. This lead should be routed directly to a commercial mortgage broker after Gate 2 completion, skipping Gate 3 optimization parameters.
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            document.getElementById('outputArea').innerHTML = output;
        }
        
        // Initialize form
        updateFormFields();
    </script>
</body>
</html>